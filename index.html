<html>
<body>
<button id="penTool">Pen</button>
<button id="eraserTool">Eraser</button>
<button id="textTool">Text</button>
<button id="selectTool">Select</button>

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
<script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>

<script>
</script>

<script>

var selectedTool = "pen";

$("#penTool").click(function(){
	selectedTool = "pen";
});

$("#eraserTool").click(function(){
	selectedTool = "eraser";
});

$("#textTool").click(function(){
	selectedTool = "text";
});

$("#selectTool").click(function(){
	selectedTool = "select";
});


var socket = io.connect('http://lpc-lr9v3e52:9000');


var penisdown = false; // ha ha
var lastPoint = { x: 0, y : 0 }

var svg = d3.select("body")
            .append("svg")
            .attr("width", 900)
            .attr("height", 600)
			.on("mousemove", mouseMove)
			.on("mousedown", mouseDown)
			.on("mouseup", mouseUp)
			.on("click", mouseClick);

var currentLine;
			
socket.on('line', function(data){
	svg.append("line")
   .attr(
	{
	"x1": data.x1,
	"y1": data.y1,
	"x2": data.x2,
	"y2": data.y2
	})
   .style("stroke-width", "1")
   .style("stroke", "rgb(255,0,0)");	
})			
			
var lineData = [];
			
function mouseMove() {
	var m = d3.mouse(this);		
	if(penisdown)
	{
		if(selectedTool == "pen")
		{
			lineData.push({x: m[0], y: m[1]});
			socket.emit('line', { x1: lastPoint.x, y1:lastPoint.y, x2: m[0], y2: m[1] });
			currentLine.attr("d", lineFunction(lineData));
		}
	   else if(selectedTool == "eraser")
		{
			socket.emit('line', { x1: lastPoint.x, y1:lastPoint.y, x2: m[0], y2: m[1] });
			$("svg").children().each(function(index, item){
				if(m[0] - 5 < item.x1 && m[0] + 5 > item.x1 && m[1] - 5 < item.y1 && m[1] + 5 > item.y1)
				{
					svg.remove(item);
				}
				
			})
	   }

	}
	lastPoint = { x: m[0], y: m[1] }
}

var lineFunction = d3.svg.line()
	.x(function(d) { return d.x; })
	.y(function(d) { return d.y; })
	.interpolate("linear");

var selectedObject = null;

var select = function(object)
{
	selectedObject = object;
}
	
function mouseDown() {
    penisdown = true;
	var m = d3.mouse(this);		
	if(selectedTool == "pen")
	{
		lineData = [];
		lineData.push({x: m[0], y: m[1]});
		currentLine = svg.append("path")
			.attr("d", lineFunction(lineData))
            .attr("stroke", "blue")
            .attr("stroke-width", 2)
            .attr("fill", "none")
			.on('click', select(this))
			;
	}	
	else if(selectedTool == "select")
		{
			$("svg").children().each(function(index, item){

			})
	   }	
}
 
function mouseUp() {
    penisdown = false;
}
 
function mouseClick() {
    console.log("mouseClick");
}			
			
</script>
</body>
</html>
